/*
Created: 09/05/2021
Modified: 09/05/2021
Model: Microsoft SQL Server 2019
Database: MS SQL Server 2019
*/

CREATE DATABASE DBTORO;
USE DBTORO;

-- Create tables section -------------------------------------------------

-- Table TB_USUARIO
DROP TABLE IF EXISTS TB_USUARIO
CREATE TABLE [TB_USUARIO]
(
 [IDT_USUARIO] Int IDENTITY(1,1) NOT NULL,
 [NUM_CPF] Varchar(14) NOT NULL,
 [TXT_SENHA] Varchar(10) NOT NULL,
 [COD_CONTA] Varchar(6) NOT NULL,
 [NOM_USUARIO] Varchar(20) NOT NULL
)
go

-- Add keys for table TB_USUARIO

ALTER TABLE [TB_USUARIO] ADD CONSTRAINT [PK_TB_USUARIO] PRIMARY KEY ([IDT_USUARIO])
go

-- Table TB_MOVIMENTACAO

DROP TABLE IF EXISTS TB_MOVIMENTACAO
CREATE TABLE [TB_MOVIMENTACAO]
(
 [IDT_MOVIMENTACAO] Int IDENTITY(1,1) NOT NULL,
 [IDT_USUARIO] Int NULL,
 [VLR_MOVIMENTACAO] Decimal(18,2) NOT NULL,
 [TIPO_MOVIMENTACAO] Char(1) NOT NULL
)
go

-- Create indexes for table TB_MOVIMENTACAO

CREATE INDEX [IX_Relationship1] ON [TB_MOVIMENTACAO] ([IDT_USUARIO])
go

-- Add keys for table TB_MOVIMENTACAO

ALTER TABLE [TB_MOVIMENTACAO] ADD CONSTRAINT [PK_TB_MOVIMENTACAO] PRIMARY KEY ([IDT_MOVIMENTACAO])
go

-- Table TB_TRANSACAO

DROP TABLE IF EXISTS TB_TRANSACAO
CREATE TABLE [TB_TRANSACAO]
(
 [IDT_TRANSACAO] Int IDENTITY(1,1) NOT NULL,
 [IDT_USUARIO] Int NULL,
 [IDT_PAPEL] Int NULL,
 [QTD_TRANSACAO] Int NOT NULL,
 [VLR_UNIDADE_PAPEL] Decimal(18,2) NOT NULL,
 [DTA_TRANSACAO] Datetime NOT NULL
)
go

-- Create indexes for table TB_TRANSACAO

CREATE INDEX [IX_Relationship2] ON [TB_TRANSACAO] ([IDT_USUARIO])
go

CREATE INDEX [IX_Relationship3] ON [TB_TRANSACAO] ([IDT_PAPEL])
go

-- Add keys for table TB_TRANSACAO

ALTER TABLE [TB_TRANSACAO] ADD CONSTRAINT [PK_TB_TRANSACAO] PRIMARY KEY ([IDT_TRANSACAO])
go

-- Table TB_PAPEL

DROP TABLE IF EXISTS TB_PAPEL
CREATE TABLE [TB_PAPEL]
(
 [IDT_PAPEL] Int IDENTITY(1,1) NOT NULL,
 [NOM_PAPEL] Varchar(7) NOT NULL,
 [QTD_PAPEL] Int NOT NULL,
 [VLR_PAPEL] Decimal(18,2) NOT NULL
)
go

-- Add keys for table TB_PAPEL

ALTER TABLE [TB_PAPEL] ADD CONSTRAINT [PK_TB_PAPEL] PRIMARY KEY ([IDT_PAPEL])
go

-- Create foreign keys (relationships) section ------------------------------------------------- 


ALTER TABLE [TB_MOVIMENTACAO] ADD CONSTRAINT [FK_TB_USU_X_TB_MOV] FOREIGN KEY ([IDT_USUARIO]) REFERENCES [TB_USUARIO] ([IDT_USUARIO]) ON UPDATE NO ACTION ON DELETE NO ACTION
go



ALTER TABLE [TB_TRANSACAO] ADD CONSTRAINT [FK_TB_USU_X_TB_USU_INV] FOREIGN KEY ([IDT_USUARIO]) REFERENCES [TB_USUARIO] ([IDT_USUARIO]) ON UPDATE NO ACTION ON DELETE NO ACTION
go



ALTER TABLE [TB_TRANSACAO] ADD CONSTRAINT [FK_TB_INV_X_TB_USU_INV] FOREIGN KEY ([IDT_PAPEL]) REFERENCES [TB_PAPEL] ([IDT_PAPEL]) ON UPDATE NO ACTION ON DELETE NO ACTION
go


--CRIACAO DE DADOS
--SELECT * FROM TB_USUARIO
INSERT INTO TB_USUARIO VALUES('12345678901','admin','300123','João luiz')
--SELECT * FROM TB_PAPEL
INSERT INTO TB_PAPEL VALUES('SANB11',10,40.77)
INSERT INTO TB_PAPEL VALUES('PETR4',9,28.44)
INSERT INTO TB_PAPEL VALUES('MGLU3',8,25.91)
INSERT INTO TB_PAPEL VALUES('VVAR3',7,25.91)
INSERT INTO TB_PAPEL VALUES('TORO4',6,115.98)
INSERT INTO TB_PAPEL VALUES('MGLU1',5,118.98)
INSERT INTO TB_PAPEL VALUES('VVAR6',4,26.01)
INSERT INTO TB_PAPEL VALUES('TORO2',3,25.91)
--SELECT * FROM TB_TRANSACAO
--SELECT * FROM TB_MOVIMENTACAO

